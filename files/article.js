function onYouTubeIframeAPIReady(){$playerIframe=document.querySelectorAll("div.video > iframe, div.player_box>iframe");$.each($playerIframe,function(){var n=this.id;$players[n]=new YT.Player(n,{events:{onReady:onPlayerReady(n),onStateChange:onPlayerStateChange(n)}})})}function onPlayerReady(){return function(){}}function onPlayerStateChange(n){return function(t){t.data==1&&PlayerPause(n)}}function PlayerPause(n){$.each($players,function(){try{this.getIframe().id!=n&&typeof this!="undefined"&&this.hasOwnProperty("getPlayerState")&&this.pauseVideo()}catch(t){return}})}function HeadlineList(n){window.innerWidth>1030&&$.post("/layout/headline",function(t){t.replace(/\s*/g,"").length>0&&($(n).after(t),LazyLoad())})}function ContentProcess(){let r=$("div.article_content"),u=r.data("id"),f=r.data("noad"),e=r.data("gallery"),t=r.html(),n="";if(t.length){if(f.toLowerCase()=="n"){let u="",r=[];if(t.indexOf("\n")>-1?u="\n":t.indexOf("<\/p>")>-1?u="<\/p>":(t.indexOf("<br>")>-1||t.indexOf("<br />")>-1)&&(t=t.replace("<br>","<br />"),u="<br />"),u.length&&(r=t.split(u)),r.length>0){const tt=/▲|▼|(圖／)/g,it=/(更多.*報導)|(東森新聞關心您)|(.*授權轉載)|(僅供參考)|(以上言論不代表)/g,rt="script|blockquote|iframe|table|a|figure|div|ul|(h\\d)";let e=[],f=0,p=$isMobile?500:600,c=p,l=!1,a="",o="",v=!1,d=!1,w=0,g=!1,y=0,b=$isMobile?"01.EBCNews_PAGE_inpage_M1":"01.EBCNews_PAGE_InRead_W1",t=$isMobile?"PAGE_inpage_M":"PAGE_InRead_W1",k=$isMobile?"[[300, 250]]":'[[1, 1],[970, 250],[970, 90],[640, 250],[640, 360],"fluid"]',ut="01.EBCNews_PAGE_M1",ft="PAGE_M1",et="[[1, 1],[300, 250],[300, 600],[320,480]]",ot="01.EBCNews_page_glia_M",st="page_glia_M",ht="[[1, 1]]",nt=$("<div><\/div>");nt.addClass("ad_box");let s=$("<div><\/div>");s.addClass("dfp_ad");s.attr("id",t);s.attr("data-code",b);s.attr("data-size",k);let h=nt.append(s).prop("outerHTML");for(var i=0;i<r.length;i++)if(n+=r[i],i+1<r.length&&(n+=u),!l){v&&f<=0&&(e=[],f=0,v=!1);let u=new RegExp("<("+rt+")[^>]*>","ig"),s=r[i].match(u);if(s)while((ary=u.exec(r[i]))!==null)f++,e[f-1]=ary[1];if(f>0){let n=e.join("|");if(u=new RegExp("<\/("+n+")>","ig"),s=r[i].match(u),s)while((ary=u.exec(r[i]))!==null){let n=e.indexOf(ary[1]);n>-1&&(e.splice(n,1),f--)}v=!0}!v&&i+1<r.length&&(o=removeHTML(r[i]),a+=o,o.length>0&&(l=it.test(o)?!0:!1,l||(d=tt.test(o)?!0:!1,d||($isMobile?(w++,w==1?n+=h.replace(t,ft).replace(b,ut).replace(k,et):w==4&&(n+=h.replace(t,st).replace(b,ot).replace(k,ht)),g?a.length>=c&&(y++,n+=h.replace(t,t+y),c+=p):a.length>=1e3&&(y++,n+=h.replace(t,t+y),g=!0,c=1e3+p)):a.length>=c&&(n+=h,l=!0)))))}}else n=t}else n=t;let s=new DOMParser,h=s.parseFromString(n,"text/html"),o=$(h).find("input[id='picgroup']");o.length&&e.toLowerCase()=="y"?$.post("/news/gallery",{id:u},function(t){t.replace(/\s*/g,"").length>0&&(n=n.replace($(o).get(0).outerHTML,t));r.html(n)}):r.html(n)}}function removeHTML(n){return n=n.replace(/<[^>]*>/g,""),n=n.replace(/&nbsp;/g,""),n.trim()}function SetHideHeight(n){let t=0;n.find("div.vote_options div.vote_row").each(function(n){return t+=Math.round($(this).height()),n===2?!1:void 0});n.find("div.vote_ballot_box").attr("style","height:"+t+"px;")}function VoteContentScroll(n){if(window.innerWidth<=1030){let t=n.find("div.vote_content"),i=t.find("div.vote_intro").height(),r=t.find("div.vote_ballot_box").height(),u=i+r;u>t.height()&&t.addClass("has_scroll")}}function ShowChart(){$("div.vote_result_bar>div").each(function(){$(this).animate({width:$(this).data("value")+"%"},100)})}var $playerIframe,$players,$curr_url;(function(n,t,i){var r="ontouchstart"in t,e=r?"touchstart":"mousedown",u=r?"touchmove":"mousemove",h=r?"touchend":"mouseup",o=r?"touchcancel":"mouseup",f=function(n){var t=Math.floor(n/3600),i=Math.floor(n%3600/60),r=Math.floor(n%3600%60);return(t==0?"":t>0&&t.toString().length<2?"0"+t+":":t+":")+(i.toString().length<2?"0"+i:i)+":"+(r.toString().length<2?"0"+r:r)},s=function(n){var t=i.createElement("audio");return!!(t.canPlayType&&t.canPlayType("audio/"+n.split(".").pop().toLowerCase()+";").replace(/no/,""))};n.fn.audioPlayer=function(t){var t=n.extend({classPrefix:"audioplayer",strPlay:"",strPause:"",strVolume:""},t),i={},h={playPause:"playpause",playing:"playing",time:"time",timeCurrent:"time-current",timeDuration:"time-duration",bar:"bar",barLoaded:"bar-loaded",barPlayed:"bar-played",volume:"volume",volumeButton:"volume-button",volumeAdjust:"volume-adjust",noVolume:"novolume",mute:"mute",mini:"mini"};for(var c in h)i[c]=t.classPrefix+"-"+h[c];return this.each(function(){if(n(this).prop("tagName").toLowerCase()!="audio")return!1;var v=n(this),y=v.attr("src"),w=v.get(0).getAttribute("autoplay"),w=w===""||w==="autoplay"?!0:!1,b=v.get(0).getAttribute("loop"),b=b===""||b==="loop"?!0:!1,l=!1;typeof y=="undefined"?v.find("source").each(function(){return y=n(this).attr("src"),typeof y!="undefined"&&s(y)?(l=!0,!1):void 0}):s(y)&&(l=!0);var c=n('<div class="'+t.classPrefix+'">'+(l?n("<div>").append(v.eq(0).clone()).html():'<embed src="'+y+'" width="0" height="0" volume="100" autostart="'+w.toString()+'" loop="'+b.toString()+'" />')+'<div class="'+i.playPause+'" title="'+t.strPlay+'"><a href="#">'+t.strPlay+"<\/a><\/div><\/div>"),h=l?c.find("audio"):c.find("embed"),h=h.get(0);if(l){c.find("audio").css({width:0,height:0,visibility:"hidden"});c.append('<div class="'+i.time+" "+i.timeCurrent+'"><\/div><div class="'+i.bar+'"><div class="'+i.barLoaded+'"><\/div><div class="'+i.barPlayed+'"><\/div><\/div><div class="'+i.time+" "+i.timeDuration+'"><\/div><div class="'+i.volume+'"><div class="'+i.volumeButton+'" title="'+t.strVolume+'"><a href="#">'+t.strVolume+'<\/a><\/div><div class="'+i.volumeAdjust+'"><div><div><\/div><\/div><\/div><\/div>');var p=c.find("."+i.bar),it=c.find("."+i.barPlayed),rt=c.find("."+i.barLoaded),d=c.find("."+i.timeCurrent),g=c.find("."+i.timeDuration),ut=c.find("."+i.volumeButton),a=c.find("."+i.volumeAdjust+" > div"),k=0,nt=function(n){theRealEvent=r?n.originalEvent.touches[0]:n;h.currentTime=Math.round(h.duration*(theRealEvent.pageX-p.offset().left)/p.width())},tt=function(n){theRealEvent=r?n.originalEvent.touches[0]:n;h.volume=Math.abs((theRealEvent.pageX-a.offset().left)/a.width())},ft=setInterval(function(){h.buffered.length>0&&(rt.width(h.buffered.end(0)/h.duration*100+"%"),h.buffered.end(0)>=h.duration&&clearInterval(ft))},100),et=h.volume,ot=h.volume=.111;Math.round(h.volume*1e3)/1e3==ot?h.volume=et:c.addClass(i.noVolume);g.html("&hellip;");d.text(f(0));h.addEventListener("loadeddata",function(){g.text(f(h.duration));a.find("div").width(h.volume*100+"%");k=h.volume});h.addEventListener("timeupdate",function(){d.text(f(h.currentTime));it.width(h.currentTime/h.duration*100+"%")});h.addEventListener("volumechange",function(){a.find("div").width(h.volume*100+"%");h.volume>0&&c.hasClass(i.mute)&&c.removeClass(i.mute);h.volume<=0&&!c.hasClass(i.mute)&&c.addClass(i.mute)});h.addEventListener("ended",function(){c.removeClass(i.playing)});p.on(e,function(n){nt(n);p.on(u,function(n){nt(n)})}).on(o,function(){p.unbind(u)});ut.on("click",function(){return c.hasClass(i.mute)?(c.removeClass(i.mute),h.volume=k):(c.addClass(i.mute),k=h.volume,h.volume=0),!1});a.on(e,function(n){tt(n);a.on(u,function(n){tt(n)})}).on(o,function(){a.unbind(u)})}else c.addClass(i.mini);w&&c.addClass(i.playing);c.find("."+i.playPause).on("click",function(){return c.hasClass(i.playing)?(n(this).attr("title",t.strPlay).find("a").html(t.strPlay),c.removeClass(i.playing),l?h.pause():h.Stop()):(n(this).attr("title",t.strPause).find("a").html(t.strPause),c.addClass(i.playing),l?h.play():h.Play()),!1});v.replaceWith(c)}),this}})(jQuery,window,document);$playerIframe=[];$players={};$(document).ready(function(n,t,i){if(!n.getElementById(i)){let r,u=n.getElementsByTagName(t)[0];r=n.createElement(t);r.id=i;r.defer=!0;r.src="https://www.youtube.com/iframe_api";u.parentNode.insertBefore(r,u)}}(document,"script","youtube-jssdk"));$curr_url=location.href.includes("?")?location.href.split("?")[0]:location.href;$(function(){if($("div.push_box").length){let n,u={direction:"vertical",speed:600,loop:!0,simulateTouch:!1,watchOverflow:!0,autoplay:{delay:4600,disableOnInteraction:!1}};window.innerWidth<=1030&&(n=new Swiper("div.push_slider",u),n.autoplay.stop());$(window).on("resize",function(){window.innerWidth>1030&&n!==undefined&&n.destroyed!==!0?n.destroy():window.innerWidth<=1030&&(n==undefined||n.destroyed==!0)&&(n=new Swiper("div.push_slider",u))});let t=$("div.push_box"),e=$("button.secretary_btn, button.push_close");function i(){t.addClass("open_push");n!==undefined&&n.destroyed!==!0&&n.autoplay.start()}function r(){t.removeClass("open_push");n!==undefined&&n.destroyed!==!0&&n.autoplay.stop()}function f(){let f=$("div.article_content").height()/2,u=$("div.article_box").height(),n=$(window);n.scrollTop()>=f?window.innerWidth<=1030?n.scrollTop()>=u&&t.hasClass("open_push")?r():n.scrollTop()<u&&!t.hasClass("open_push")&&i():t.hasClass("open_push")||i():t.hasClass("open_push")&&r()}$(window).on("scroll",f);e.on("click touchstart",function(n){n.preventDefault();$(window).off("scroll",f);t.hasClass("open_push")?r():i()})}let n=$("div.article"),t=$("div.top_wrapper").find("div.sidebar");if(n.length){let r=$("audio");if(r.length){r.audioPlayer();let n={},t=navigator.userAgent.toLowerCase(),i=t.match(/version\/([\d.]+).*safari/)?n.safari=1:0;if(n.safari){$("div.audioplayer-bar").addClass("lock");$("div.audioplayer-playpause").on("click",function(){$("div.audioplayer-bar").removeClass("lock")})}}ContentProcess();SetContentDFP();let u=n.data("code"),i=t.find("div.section");HotList(u,i[0]);HeadlineList(i[1]);RealtimeList(u,"",i[2])}if(VoteList(t.find("div.section").not(".sticky").last()),window.innerWidth<=1030&&$.post("/vote/list",{platform:"mobile",page:"news"},function(n){if(n.replace(/\s*/g,"").length>0){let t=$("#_popIn_recommend_above");t.after(n)}}),$("div.player_slider div.swiper-slide").length){new Swiper("div.player_slider",{slidesPerView:3,slidesPerGroup:3,spaceBetween:20,simulateTouch:!1,watchOverflow:!0,breakpoints:{767:{slidesPerView:2,slidesPerGroup:2,spaceBetween:12}},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}});let n=$("div.player_item");n.on("click",function(){let t=$(this).data("video"),r=$(this).data("platform"),u=$(this).find("div.item_text").text().trim(),i="";i=r.toLowerCase()=="fb"?"https://www.facebook.com/plugins/video.php?href=https%3A%2F%2Fwww.facebook.com%2Fnews.ebc%2Fvideos%2F"+t+"%2F&show_text=0":"https://www.youtube.com/embed/"+t+"?enablejsapi=1&rel=0&autoplay=1&mute=1";$("div.player_box").find("iframe").attr({src:i,title:u});n.removeClass("active");$(this).addClass("active")})}$.post("/news/pushlist",{layout:$isMobile?"mobile":"web"},function(n){n.replace(/\s*/g,"").length>0&&($("div.article_bottom").append(n),LazyLoad())})});$(window).on("load",function(){let n=$("#push_list").find("div[id^=div-onead-nd]");n.length&&n.each(function(){let n=$(this).children("div")[0];typeof n=="undefined"||$(n).css("display")=="none"?($(this).prev().removeAttr("style"),$(this).remove()):$(this).prev().remove()});let t=$("div.article_content img");ArticleImgMaxWidth(t);$(window).on("resize",function(){ArticleImgMaxWidth(t)});if($("div.article").length){let n=$('div.article_content iframe[src*="facebook"]');function t(){window.innerWidth<=767?n.each(function(){let n=$(this).width()*($(this).attr("height")/$(this).attr("width"))+40;$(this).attr("style","height:"+n+"px;")}):n.removeAttr("style")}t();$(window).on("resize",t)}if($("div.gallery").length){let n=new Swiper("div.gallery_thumbs",{watchSlidesVisibility:!0,watchSlidesProgress:!0});new Swiper("div.gallery",{spaceBetween:10,loop:!0,pagination:{el:".swiper-pagination",type:"fraction"},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},thumbs:{swiper:n}})}});$(window).on("scroll",function(){window.innerWidth<=1030&&(CheckOverlay(),$("#footer_M1").length&&!$("#footer_M1").children().length&&($("div[id^=onead-layout]").length&&$("div[id^=onead-layout]").css("display")!="none"||$("div.overlay_box.ad").length||$("#r18").length||SetFooterDFP()))});$("div.share button.i_facebook").on("click",function(){window.open("http://www.facebook.com/sharer/sharer.php?u=".concat(encodeURIComponent($curr_url)),"Facebook","width=640,height=640")});$("div.share button.i_line").on("click",function(){window.open("https://social-plugins.line.me/lineit/share?url=".concat(encodeURIComponent($curr_url)),"Line")});$("div.share button.i_link").on("click",function(){let n=document.createElement("input");n.setAttribute("value",window.location.href);document.body.appendChild(n);n.select();document.execCommand("copy");document.body.removeChild(n);$.post("/ajax/showmessage",{type:0,message:encodeURIComponent("已成功複製連結<br>歡迎多分享轉貼出去")},function(n){let t=$("div.overlay_box");t&&t.remove();$("main").after(n)})});const fontSize="NewsFontSize";let fontZoomIn=$("button.font_zoom_in"),fontZoomOut=$("button.font_zoom_out"),articleContent=$("div.article_content"),articleFontSize;localStorage.getItem(fontSize)===null?(articleFontSize=20,localStorage.setItem(fontSize,articleFontSize)):articleFontSize=parseInt(localStorage.getItem(fontSize),10);articleContent.attr("style","font-size:"+articleFontSize+"px;");fontZoomIn.on("click",function(){fontZoomOut.removeClass("disabled");articleFontSize<26&&(articleFontSize+=2,articleContent.attr("style","font-size:"+articleFontSize+"px;"),articleFontSize===26&&$(this).addClass("disabled"));localStorage.setItem(fontSize,articleFontSize)});fontZoomOut.on("click",function(){fontZoomIn.removeClass("disabled");articleFontSize>16&&(articleFontSize-=2,articleContent.attr("style","font-size:"+articleFontSize+"px;"),articleFontSize===16&&$(this).addClass("disabled"));localStorage.setItem(fontSize,articleFontSize)});$("div.img_box[data-video]").on("click",function(){let n=$(this),i=n.data("video"),r=n.data("platform"),t;n.closest("div.article").length&&(t=$("div.article_header h1").text());$.post("/ajax/showvideo",{platform:r,code:i,title:t,autoplay:!0},function(n){if(n.replace(/\s*/g,"").length>0){PlayerPause("overlay_player");let t=$("div.overlay_box");t&&t.remove();$("main").after(n);PageDFP("div.overlay_box")}})});$(function(){$("div.vote_box").length&&$("div.vote_box").each(function(){let n=$(this);if(n.find("div.vote_options div.vote_row").length>3){SetHideHeight(n);$(window).on("resize",SetHideHeight(n));n.find("div.vote_btn_box.show_all_box").addClass("show");n.find("div.vote_btn_box.show_all_box").on("click",function(){$(window).off("resize",SetHideHeight($(this)));n.find("div.vote_ballot_box").attr("style","height: auto;");$(this).removeClass("show")})}})});$body.on("click","button.vote_toggle",function(){$body.addClass("scroll_lock");let n=$(this).data("id"),t="N",i=getCookie($voted_cookie);if(i.length>0)if(i.indexOf(",")>-1){let r=i.split(",");r.indexOf(n.toString())>-1&&(t="Y")}else i==n&&(t="Y");$.post("/vote/show",{id:n,voted:t},function(i){if(i.replace(/\s*/g,"").length>0){$("main").after(i);window.innerWidth>1030&&PageDFP("div.vote_body");t=="Y"&&ShowChart();let r=$("#vote"+n+".overlay_box.vote");r.addClass("show");VoteContentScroll(r)}})});$body.on("touchstart","div.overlay div.vote_content",function(){$(this).removeClass("has_scroll")});$body.on("click","div.vote_options input.v_option",function(){let n=$("button.vote_btn"),t=$("div.vote_options");n.hasClass("disable")?t.find("input[name=vote]:checked").length>0&&n.removeClass("disable"):t.find("input[name=vote]:checked").length<1&&n.addClass("disable")});$body.on("click","button.vote_btn",function(n){n.preventDefault();let i=$(this),t=i.closest("div.vote_box");if(t.addClass("loading"),t.find("input[name=vote]:checked").length>0){t.find("div.vote_content").scrollTop(0);let u=t.data("id"),f=t.data("type"),r,n=t.find("input[name=vote]:checked");r=n.length==1?n.val():$.map(n,function(n){return $(n).val()}).toString();$.post("/vote/send",{id:u,type:f,value:r},function(n){t.removeClass("loading");n.replace(/\s*/g,"").length>0?(t.find("div.vote_ballot_box").empty().append(n),ShowChart(),t.addClass("done"),i.text("投票完成！")):alert("發生錯誤，請再試一次")})}else alert("請選擇您的答案")})