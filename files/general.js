function InitDfp(){googletag.pubads().enableSingleRequest();googletag.pubads().collapseEmptyDivs(!0);googletag.pubads().enableLazyLoad({fetchMarginPercent:200,renderMarginPercent:200,mobileScaling:2});googletag.enableServices()}function LoadDfp(n,t,i,r){if(r=="Y"&&$isMobile||r=="N"&&!$isMobile){let r=$groupUnit.indexOf(n)>-1?"/23010209493/":n.toLowerCase()=="01.EBCNews_splash_M1".toLowerCase()?"/21895488495/":"/21959889555/";googletag.cmd.push(function(){$dfpSlot=googletag.defineSlot(r+n,t,i).addService(googletag.pubads());SetTarget($dfpSlot);InitDfp();googletag.display(i)})}}function SetTarget(n){cat1.length>0&&n.setTargeting("cat1",cat1.split(","));cat2.length>0&&n.setTargeting("cat2",cat2.split(","));col.length>0&&n.setTargeting("col",col);pid.length>0&&n.setTargeting("pid",pid);adt.length>0&&n.setTargeting("adt",adt);content_keyvalues.length>0&&$.each(content_keyvalues,function(t,i){n.setTargeting(i.key,i.values)})}function PageDFP(n){let t;if(t=n?$(n).find("div.dfp_ad"):$("div.dfp_ad"),t.length){let n,r,u,i,f;$(t).each(function(){n=$(this);typeof n.attr("id")!="undefined"&&(i=n.attr("id"),r=n.data("code"),u=n.data("size"),f=n.data("mobile"),i=="splash_M1"?$("div.overlay_box.ad").length&&(window.innerWidth<=1030?LoadDfp(r,u,i,f):$("div.overlay_box.ad").remove()):i=="footer_M1"?window.innerWidth>1030&&LoadDfp(r,u,i,f):LoadDfp(r,u,i,f))})}}function CheckDFP(){$("div.dfp_ad").length&&$("div.dfp_ad").each(function(){let n=$(this),t=n.data("mobile");if((t=="Y"&&$isMobile||t=="N"&&!$isMobile)&&typeof n.attr("id")!="undefined"&&n.children().length){let t=n.find("iframe");if(n.attr("id").indexOf("splash_M1")<0)if(t.length>0||n.height()>0)n.show();else{let t=n.closest("div.ad_box");t.length?t.hasClass("footer_ad")?n.remove():t.remove():n.remove()}else t.length&&CheckOverlay()}})}function CheckOverlay(){let n=$("div.overlay_box.ad");if(n.length&&!n.hasClass("show")){let t=n.find("div.dfp_ad[id='splash_M1']"),i=t.find("iframe");!$("#r18").length&&t.length&&i.length&&$("div.overlay_box.ad").addClass("show")}}function SetContentDFP(){let u=$("div.article_content"),f=$isMobile?"Y":"N",n,t,i,r=u.find("div.dfp_ad");r&&r.each(function(){let r=$(this);typeof r.attr("id")!="undefined"&&(t=r.attr("id"),n=r.data("code"),i=r.data("size"),LoadDfp(n,i,t,f))})}function SetFooterDFP(){let n=$("#footer_M1");if(n.length&&n.children().length==0){let t=n.attr("id"),i=n.data("code"),r=n.data("size"),u=n.data("mobile");LoadDfp(i,r,t,u)}}function HideExtraLi(){let i=$("nav"),t=$("nav ul li");if(window.innerWidth>1030){let n=0;t.each(function(i){i<t.length-2&&(n+=Math.round($(this).width()))});i.attr("style","max-width:"+n+"px")}else i.attr("style","max-width: none;");let f=$("nav").offset().left,r=$("nav").width(),e=Math.round(f+r),u=$("div.menu_more"),n=$("div.menu_more ul");if(window.innerWidth>1030){$(t.toArray().reverse()).each(function(){let t=$(this).data("id"),i=$(this).offset().left,r=$(this).width(),u=Math.round(i+r);u>e?$(this).hasClass("hide")||($(this).clone().prependTo(n),$(this).addClass("hide")):($(this).removeClass("hide"),n.find('li[data-id="'+t+'"]').remove())});let i=0;$("nav ul li:not(.hide)").each(function(){i+=Math.round($(this).width())});let f=(Math.round(r)-i)*-1;u.attr("style","left:"+f+"px;");n.children().length&&u.addClass("show")}else t.removeClass("hide"),n.children().length&&n.empty()}function MoveEl(){window.innerWidth<=1030?$("div.tool_nav a.ebc_tv_icon").length>0&&$("header a.ebc_tv_icon").prependTo($("div.navbar div.mobile_tool_nav")):$("div.tool_nav a.ebc_tv_icon").length===0&&$("header a.ebc_tv_icon").prependTo($("div.tool_nav"));window.innerWidth<=1030?$("div.navigation a.login_btn").length>0&&$("a.login_btn").appendTo($("div.navbar div.mobile_tool_nav")):$("div.navigation a.login_btn").length===0&&$("a.login_btn").appendTo($("div.navigation div.widget_box"));$("div.latest_news_bar").length&&(window.innerWidth<=767?$("div.top_wrapper div.latest_news_bar").length>0&&$("div.latest_news_bar").prependTo($("main")):$("div.top_wrapper div.latest_news_bar").length===0&&$("div.latest_news_bar").prependTo($("div.top_wrapper div.content").eq(0)));$("div.share_box").length&&(window.innerWidth<=767?$("div.article_main_box div.share_box").length>0&&$("div.share_box").addClass("hide").appendTo($("header")):$("div.article_main_box div.share_box").length===0&&$("div.share_box").prependTo($("div.article_main_box")).removeClass("hide"))}function WordLimit(n){let t=$("div.word_limit a.item h3.item_title");if(t.length)if(window.innerWidth>1260){let i;i=$("div.hot_news div.word_limit").length?Math.floor($("div.hot_news div.word_limit").width()/16)*2:Math.floor(t.eq(0).width()/16)*2;t.each(function(t){let u=Math.floor($(this).next("div.item_time").outerWidth(!0)/16),r=i-u-2;if(n[t]&&n[t].length>r){let i=n[t].substring(0,r)+"...";$(this).html(i)}else $(this).html(n[t])})}else t.each(function(t){$(this).html(n[t])})}function showDesktopFooterAd(){let n=$("div.bottom_fixbox_inner"),t=window.innerHeight,i=$(window);i.scrollTop()>=t?n.addClass("show_ad"):n.removeClass("show_ad")}function ResetTimeout(){$("div.overlay_box.show").length||typeof $timeout!="undefined"&&(window.clearTimeout($timeout),window.innerWidth>1030&&ShowIdel())}function ShowIdel(){window.innerWidth>1030&&($timeout=setTimeout(function(){let n=$("div.overlay_box.show");n.length==0&&$.post("/ajax/idleshow",function(n){n.replace(/\s*/g,"").length>0&&($("main").after(n),PageDFP("div.idle_main"))})},3e5))}function RecordAD(n,t){var i=$(t).data("id");n.toUpperCase()=="C"?typeof i!="undefined"&&i!=""&&$.post("/ajax/recad",{type:0,id:i}):n.toUpperCase()=="V"&&typeof i!="undefined"&&i!=""&&$.post("/ajax/recad",{type:1,id:i})}function VoteList(n){window.innerWidth>1030&&$.post("/vote/list",{platform:"web"},function(t){t.replace(/\s*/g,"").length>0&&$(n).append(t)})}function RealtimeList(n,t,i){window.innerWidth>1030&&$.post("/layout/realtime",{cate_specify:n,cate_exclude:t},function(n){n.replace(/\s*/g,"").length>0&&$(i).after(n)})}function HotList(n,t){window.innerWidth>1030&&$.post("/layout/hot",{cate_code:n},function(n){n.replace(/\s*/g,"").length>0&&$(t).after(n)})}function VideoList(n,t){$.post("/video/changetopic",{id:n},function(n){n.replace(/\s*/g,"").length>0&&($(t).empty().append(n),LazyLoad())})}var $isMobile=isMobileDevice(),$dfpSlot=null,$footerSlot=null,$groupUnit=["01.EBCNews_page_glia_W","01.EBCNews_page_glia_M"];$(document).ready(function(){firebase.initializeApp({apiKey:"AIzaSyDk2t7rPVnDqo0-wcPM9np2AVsHhRHKXaQ",authDomain:"newsfirebase-it.firebaseapp.com",databaseURL:"https://newsfirebase-it.firebaseio.com",projectId:"newsfirebase-it",storageBucket:"newsfirebase-it.appspot.com",messagingSenderId:"556337606524",appId:"1:556337606524:web:e870b91dd77d29c86c3ef9"});const t=firebase.messaging(),n="PermissionGranted";"Notification"in window&&(Notification.permission!=="denied"?Notification.permission!=="granted"&&Notification.requestPermission().then(i=>{i==="granted"&&t.getToken().then(t=>{t&&(localStorage.getItem(n)===null||localStorage.getItem(n)!==t)&&($.post("/ajax/savetoken",{code:t}),localStorage.setItem(n,t))}).catch(()=>{})}):localStorage.getItem(n)!==null&&localStorage.removeItem(n));t.onMessage(n=>{var i,r,e,t;let u="東森新聞",f="即時新聞推薦";if(i="https://news.ebc.net.tw/img/favicon/favicon-128x128.png",r="https://news.ebc.net.tw",typeof n.data!="undefined"&&n.data!==null){let t=n.data;u=typeof t.title=="undefined"?u:t.title;f=typeof t.body=="undefined"?f:t.body;i=typeof t.icon=="undefined"?i:t.icon;r=typeof t.click_action=="undefined"?r:t.click_action}e={body:f,icon:i,data:r,tag:"東森新聞"};t=new Notification(u,e);setTimeout(t.close.bind(t),1e4);t.onclick=function(n){n.preventDefault();t.close();window.open(t.data)}})});var $isMobile=isMobileDevice(),timeLoopId,$body=$("body"),$header=$("header");$.post("/ajax/checkdomain",{url:location.href},function(n){n!==null&&n!==""&&(location.href=n)});$(function(){function k(){let n=$(window).scrollTop();s.length&&(n>150?s.removeClass("hide"):s.addClass("hide"));n>360?(n<p?$header.removeClass("hide"):$header.addClass("hide"),p=n):$header.removeClass("hide")}function c(t){let i=$("div.submenu_content div.section").length;n=(n+t+i)%i;$("div.submenu_content div.section").eq(n).show().siblings("div.section").hide();$("div.submenu_tabs button").eq(n).addClass("active").siblings().removeClass("active")}function a(){u.option("disabled",!0);b.removeClass("sorting")}function o(){u.option("disabled",!0);$("div.popup_menu_box").removeClass("sorting");$("div.navigation").removeClass("open_popup_menu")}if($("a.ConvertLanguage").html()=="繁体"&&$("a.ConvertLanguage").html("繁體"),MoveEl(),HideExtraLi(),$("div.news_flash").length){let t=$("div.news_flash div.swiper-slide").length,n=new Swiper("div.news_flash",{direction:"vertical",speed:600,loop:t>1,simulateTouch:!1,watchOverflow:!0,autoplay:{delay:5e3,disableOnInteraction:!1},navigation:{nextEl:"div.news_flash_next",prevEl:"div.news_flash_prev"}});$("div.news_flash").hover(function(){n.autoplay.stop()},function(){n.autoplay.start()})}PageDFP();$("img.lazy").length&&LazyLoad();let p=0,s=$("div.share_box");if(window.innerWidth<=1030){$(window).on("scroll",k);$("#menu li a.current").length&&$("div.main_nav_box").scrollLeft($("#menu li a.current").offset().left-66)}else $.post("/layout/weather",function(n){n.replace(/\s*/g,"").length>0&&$("header div.navigation").find("div.container").append(n)}),ShowIdel();let w=$("div.sidebar");w.find("div.section:first-child").each(function(){let t=$(this).find("div.section_title"),n=$(this).parent(w).prev("div.content").find("div.section:first-child");t.length===0&&n.find("div.section_title").length&&(n.find("div.tab_list_wrap").length?$(this).addClass("align_top_s2"):n.hasClass("col3")?$(this).addClass("align_top_s3"):$(this).addClass("align_top"))});let i=$("div.submenu_box"),h=$("div.submenu_box_bg"),n;$("nav ul li").on("mouseover",function(){if($(this).find("a").addClass("active"),$(this).siblings().find("a").removeClass("active"),$("div.search input").blur(),$("div.navbar div.search_keywords").removeClass("show"),i.empty(),h.removeClass("show"),$(this).hasClass("has_submenu")){let t=$(this).data("code"),r=$(this).data("name");h.addClass("show");$.post("/ajax/submenu",{cate_code:t,cate_name:r},function(t){t.replace(/\s*/g,"").length>0&&(i.append(t),n=0,$("div.submenu_tabs button").eq(n).addClass("active"),$("div.submenu_content div.section").eq(n).show())})}});$("div.main_nav").on("mouseleave",function(){$("nav ul li a").removeClass("active");i.empty();h.removeClass("show")});i.on("click","div.submenu_tabs button",function(){n=$(this).index();c(0)});i.on("click","div.submenu_nav button.submenu_btn_next",function(){c(1)});i.on("click","div.submenu_nav button.submenu_btn_prev",function(){c(-1)});let r=$("div.navigation");r.removeClass("fix_transition");let b=$("div.popup_menu_box");$("button.popup_menu_toggle").on("click touchstart",function(n){n.preventDefault();r.hasClass("open_popup_menu")?(o(),HideExtraLi()):(r.addClass("open_popup_menu"),$("div.popup_menu_wrap").scrollTop(0))});$("main, footer").on("click",function(){r.hasClass("open_popup_menu")&&(o(),HideExtraLi())});let d=getCookie($cate_list).split("|"),e=d.map(function(n,t){return t+1}),l=new Sortable(document.getElementById("menu"),{disabled:!0,store:{get:function(){return Array.from($("#menu li"),n=>$(n).data("id"))}}}),u=new Sortable(document.getElementById("popup_menu"),{animation:160,ghostClass:"active",disabled:!0,store:{get:function(){let n=getCookie($menu_sort);return n!=""?n.split("|"):[]},set:function(n){let t=n.toArray();l.sort(t,!0);setCookie($menu_sort,t.join("|"),365,"");let i=Array.from($("#menu li"),n=>$(n).data("value")).join("|");setCookie($cate_sort,i,365,"")}}}),f;$("button.sorting_btn").on("click",function(){u.option("disabled",!1);f=getCookie($menu_sort)==""?e:getCookie($menu_sort).split("|");b.addClass("sorting");$("nav ul li").removeClass("hide");$("div.menu_more ul").empty()});$("button.sorting_default").on("click",function(){l.sort(e,!0);u.sort(e,!0);setCookie($menu_sort,e.join("|"),365,"");setCookie($cate_sort,"",1,"");a();HideExtraLi()});$("button.sorting_cancel").on("click",function(){l.sort(f,!0);u.sort(f,!0);setCookie($menu_sort,f.join("|"),365,"");a();HideExtraLi()});$("button.sorting_save").on("click",function(){a();HideExtraLi()});let t=$("div.tab_list_box"),v=$("button.tab_btn_next"),y=$("button.tab_btn_prev");t.each(function(){let n=$(this).find("div.tab_list").prop("scrollWidth");n>$(this).width()&&$(this).find("button.tab_btn_next").show()});t.on("scroll",function(){$(this).scrollLeft()<=0?$(this).find(y).hide():$(this).find(y).show();Math.round($(this).scrollLeft()+$(this).width())>=Math.round($(this).find("div.tab_list").prop("scrollWidth"))?$(this).find(v).hide():$(this).find(v).show()});v.on("click",function(){let i=$(this).closest(t).width()*.8,n=$(this).parent(t).scrollLeft();n+=i;$(this).parent(t).animate({scrollLeft:n},500)});y.on("click",function(){let i=$(this).closest(t).width()*.8,n=$(this).parent(t).scrollLeft();n-=i;$(this).parent(t).animate({scrollLeft:n},500)});$("button.mobile_search_toggle").on("click touchstart",function(n){n.preventDefault();let t=$("div.navbar");t.hasClass("open_mobile_search")?($("div.mobile_search_hotnews").remove(),$("div.mobile_search_ad").remove(),t.removeClass("open_mobile_search"),$("div.search input").blur()):$.post("/ajax/mobilesearch",function(n){n.replace(/\s*/g,"").length>0&&($("div.tool_nav div.search_box").append(n),PageDFP("div.mobile_search_ad"));t.addClass("open_mobile_search")});r.hasClass("open_popup_menu")&&(o(),HideExtraLi())});$("div.search_box input").on("focus",function(){$("div.navbar div.search_keywords").addClass("show");o();HideExtraLi()});$("div.footer_ad button.btn_close").on("click touchstart",function(n){n.preventDefault();$(this).closest("div.footer_ad").addClass("hide")});$body.on("touchstart",function(){})});$(window).on("load",function(){if(window.innerWidth>1030){$("div.weather_box").length&&new Swiper("div.weather_box",{direction:"vertical",speed:600,loop:!0,simulateTouch:!1,watchOverflow:!0,autoplay:{delay:4600}});let n=$("div.text_ad_box");if(n.length){let t=new Swiper("div.text_ad_box div.text_ad",{effect:"fade",speed:400,simulateTouch:!1,autoplay:{delay:6e3,disableOnInteraction:!1}});n.hover(function(){t.autoplay.stop()},function(){t.autoplay.start()});let i=$("button.text_ad_more");i.on("click",function(){$(this).closest("div.text_ad_box").toggleClass("open_options")});$(window).on("click",function(t){$(t.target).is(".text_ad_more")||n.removeClass("open_options")})}}if(CheckDFP(),$("div.bottom_fixbox div.desktop_visible .footer_ad iframe").length&&window.innerWidth>1030)if($("div.bottom_fixbox div.desktop_visible .footer_ad iframe").height()<=1)$("div.bottom_fixbox div.desktop_visible .footer_ad").addClass("hide");else $(window).on("scroll",showDesktopFooterAd);$("div.bottom_fixbox div.mobile_visible .footer_ad iframe").length&&window.innerWidth<=1030&&$("div.bottom_fixbox div.mobile_visible .footer_ad iframe").height()<=1&&$("div.bottom_fixbox div.mobile_visible .footer_ad").addClass("hide");$("a.news_ad").length&&$("a.news_ad").each(function(){RecordAD("V",$(this))})});$(window).on("scroll",function(){if(window.innerWidth>1030){let n=$(window).scrollTop(),t=$("div.sky_ad").height();$("div.sky_ad iframe").length?n>=t+40?$header.addClass("shrink"):$header.removeClass("shrink"):n>=40?$header.addClass("shrink"):$header.removeClass("shrink")}});$(window).on("scroll",ResetTimeout).on("click",ResetTimeout).on("mousemove",ResetTimeout).on("mousedown",ResetTimeout).on("keydown",ResetTimeout);$(window).on("click",function(n){$(n.target).is("div.navbar div.search input")||$("div.navbar div.search_keywords").removeClass("show")});$(window).on("resize",function(){HideExtraLi();MoveEl()});$("div.search input").on("keyup",function(n){n.preventDefault();let t=n.keyCode?n.keyCode:n.which;if(t==13){let n=$(this).val().trim();n.length<2?alert("請輸入2個字以上的關鍵字！"):location.href="/search/keyword/"+encodeURIComponent(n)}});$("div.lead_search input").on("keyup",function(n){n.preventDefault();let t=n.keyCode?n.keyCode:n.which;if(t==13){let n=$(this).val().trim();n.length<2?alert("請輸入2個字以上的關鍵字！"):location.href="/search/keyword/"+encodeURIComponent(n)}});$("button.search_submit").on("click touchstart",function(n){n.preventDefault();let t=$(this).siblings("input").val().trim();t.length<2?alert("請輸入2個字以上的關鍵字！"):location.href="/search/keyword/"+encodeURIComponent(t)});$body.on("click","button.overlay_reduce",function(n){n.preventDefault();$("div.overlay_box.video").toggleClass("fixed")});$body.on("click","button.overlay_close, button.overlay_x , div.overlay_bg",function(n){n.preventDefault();let t=$(this.closest("div.overlay_box"));if(t.attr("id")!="undefined"&&t.attr("id")=="r18"?($("#r18").remove(),$("div.overlay_box.ad").addClass("show"),$body.animate({scrollTop:0},600),$("div.article_box").show()):t.remove(),$body.removeClass("scroll_lock"),typeof $dfpSlot!="undefined"&&$dfpSlot!=null)["splash_M1","LD_300250_W","vpage_W","vot_320100_W"].indexOf($dfpSlot.getSlotElementId())>-1&&googletag.destroySlots([$dfpSlot]);ResetTimeout()});$("a.ConvertLanguage").on("click",function(){var n=$(this).data("type"),t=$(this).data("name");setCookie(t,n,365,"");window.location.reload()})